<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Resultados Eurovisión</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
<div class="container">
  <h1>Resultados Finales</h1>
  <div id="resultados"></div>
  <div id="clasificacion" style="margin-top: 2rem;"></div>
</div>
<script>
  const top = JSON.parse(localStorage.getItem("top26_final")) || [];
  const usuarios = [1, 2, 3, 4];
  const votos = usuarios.map(i => JSON.parse(localStorage.getItem("votos_usuario" + i)) || []);
  const nombres = usuarios.map(i => "Usuario " + i);

  if (votos.some(v => v.length === 0) || top.length === 0) {
    document.getElementById("resultados").innerHTML = "<p>Faltan datos de votación o ranking final.</p>";
  } else {
    const getPuntos = (lista, pais) => lista.find(v => v.pais === pais)?.puntos || '-';

    let tabla = "<table><thead><tr><th>Pos.</th><th>País</th>" +
      nombres.map(n => `<th>${n}</th>`).join("") + "</tr></thead><tbody>";
    let diferencias = [0, 0, 0, 0];

    top.sort((a,b) => a.posicion - b.posicion).forEach(entry => {
      const fila = [`<td>${entry.posicion}</td><td>${entry.pais}</td>`];
      votos.forEach((v, idx) => {
        const puntos = getPuntos(v, entry.pais);
        const diff = typeof puntos === 'number' ? Math.abs(puntos - entry.posicion) : "-";
        if (typeof diff === 'number') diferencias[idx] += diff;
        fila.push(`<td>${puntos}</td>`);
      });
      tabla += `<tr>${fila.join("")}</tr>`;
    });

    tabla += "</tbody></table>";
    document.getElementById("resultados").innerHTML = tabla;

    const ranking = diferencias.map((dif, idx) => ({
      nombre: nombres[idx],
      diferencia: dif
    })).sort((a, b) => a.diferencia - b.diferencia);

    const clasif = "<h2>Clasificación General</h2><table><thead><tr><th>Posición</th><th>Usuario</th><th>Diferencia Total</th></tr></thead><tbody>" +
      ranking.map((r, i) => `<tr><td>${i + 1}</td><td>${r.nombre}</td><td>${r.diferencia}</td></tr>`).join("") +
      "</tbody></table>";

    document.getElementById("clasificacion").innerHTML = clasif;
  }
</script>
</body>
</html>
